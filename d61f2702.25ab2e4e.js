(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{205:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return l}));var r=n(2),o=n(11),a=(n(0),n(217)),c={id:"deployment",title:"Deployment"},i={id:"technology/deployment",isDocsHomePage:!1,title:"Deployment",description:"Once you have configured your resources package and you have OpenCRVS running locally, you are ready to provision and deploy OpenCRVS.",source:"@site/docs/technology/Deployment.mdx",permalink:"/opencrvs-core/docs/technology/deployment",sidebar:"docs",previous:{title:"Technical interoperability",permalink:"/opencrvs-core/docs/technology/technicalInteroperability"},next:{title:"Webhook integration",permalink:"/opencrvs-core/docs/technology/webhooks"}},s=[{value:"How can I install and manage an OpenCRVS server cluster of nodes?",id:"how-can-i-install-and-manage-an-opencrvs-server-cluster-of-nodes",children:[]},{value:"How can I set up continuous integration and delivery?",id:"how-can-i-set-up-continuous-integration-and-delivery",children:[]},{value:"Why Docker Swarm? ...and is there Kubernetes support?",id:"why-docker-swarm-and-is-there-kubernetes-support",children:[]},{value:"How do I build my containers and push a version to Dockerhub?",id:"how-do-i-build-my-containers-and-push-a-version-to-dockerhub",children:[]},{value:"How do I manage a Docker Swarm?",id:"how-do-i-manage-a-docker-swarm",children:[]}],p={rightToc:s};function l(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Once you have configured your resources package and you have OpenCRVS running locally, you are ready to provision and deploy OpenCRVS."),Object(a.b)("p",null,"The ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/opencrvs/opencrvs-core"}),"OpenCRVS Core")," contains a deployment script run via ",Object(a.b)("inlineCode",{parentName:"p"},"yarn")," commands in ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/opencrvs/opencrvs-core/blob/master/package.json"}),"package.json")," to deploy to a staging, QA or production cluster ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/opencrvs/opencrvs-core/blob/master/deploy.sh"}),"here"),"."),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},'yarn deploy:qa <Your host> <Dockerhub hash for your OpenCRVS version, git hash or "latest"> <path to your resources package>')),Object(a.b)("p",null,"OpenCRVS should be deployed on a minimum cluster of 3 nodes, each with the following specifications:"),Object(a.b)("h4",{id:"8-gb-memory-preferably-16-gb--160-gb-disk--ubuntu-18043-lts-x64"},"8 GB Memory (preferably 16 GB) / 160 GB Disk / Ubuntu 18.04.3 (LTS) x64"),Object(a.b)("h2",{id:"how-can-i-install-and-manage-an-opencrvs-server-cluster-of-nodes"},"How can I install and manage an OpenCRVS server cluster of nodes?"),Object(a.b)("p",null,"An ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.ansible.com/"}),"Ansible")," playbook script is provided ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/opencrvs/opencrvs-core/blob/master/infrastructure/server-setup/playbook.yml"}),"here")," to automate the vast majority of your server cluster setup."),Object(a.b)("p",null,"To prepare your server cluster, some pre-requisites and instructions are documented ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/opencrvs/opencrvs-core/tree/master/infrastructure/server-setup"}),"here"),"."),Object(a.b)("h2",{id:"how-can-i-set-up-continuous-integration-and-delivery"},"How can I set up continuous integration and delivery?"),Object(a.b)("p",null,"We provide an example ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://travis-ci.org/"}),"Travis")," ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/opencrvs/opencrvs-core/blob/master/.travis.yml"}),"configuration")," to automate unit testing, end-to-end testing, Docker compose / push to Dockerhub and deployment to a staging environment."),Object(a.b)("h2",{id:"why-docker-swarm-and-is-there-kubernetes-support"},"Why Docker Swarm? ...and is there Kubernetes support?"),Object(a.b)("p",null,Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://docs.docker.com/engine/swarm/"}),"Docker Swarm")," was chosen for it's simplicity, so that previously unskilled system administrators can quickly up-skill in the techniques of private and public cloud infrastructure management. We wanted to democratise the containerisation benefits of AWS/Kubernetes style public cloud deployments for developing nations."),Object(a.b)("p",null,"Some nations may be located far from a developed world datacentre. Many nations may not be able to legally support international data storage of citizen data. Often getting the legal approval requires regulatory change which obviously can take some time. In the short term, these nations may not have access to the development skills necessary to manage a complicated distributed cloud deployment, so ease-of-use is paramount."),Object(a.b)("p",null,'Docker Swarm makes it easy to commence service distribution privately and then migrate publicly when an organisation is ready to do so. Docker Swarm automatically configures a "round robin" load balanced cluster, and provides Service Discovery out-the-box.'),Object(a.b)("h2",{id:"how-do-i-build-my-containers-and-push-a-version-to-dockerhub"},"How do I build my containers and push a version to Dockerhub?"),Object(a.b)("p",null,"There are a number of docker scripts available via ",Object(a.b)("inlineCode",{parentName:"p"},"yarn"),". If you need to manage the docker containers, some of these scripts may be useful."),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"yarn compose:push:version")," script will version and push your containers."),Object(a.b)("h2",{id:"how-do-i-manage-a-docker-swarm"},"How do I manage a Docker Swarm?"),Object(a.b)("p",null,"A number of other useful Docker commands you will need in order to manage the swarm cluster are accessible ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/opencrvs/opencrvs-core/tree/master/infrastructure/server-setup"}),"here"),"."),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Coming soon")),Object(a.b)("p",null,"We are working on a ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://kubernetes.io/"}),"Kubernetes")," implementation, so that smaller nations can have the option to hand over swarm system administration to a 3rd party such as AWS / Google."))}l.isMDXComponent=!0},217:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var r=n(0),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=o.a.createContext({}),l=function(e){var t=o.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=l(e.components);return o.a.createElement(p.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(n),d=r,m=u["".concat(c,".").concat(d)]||u[d]||b[d]||a;return n?o.a.createElement(m,i(i({ref:t},p),{},{components:n})):o.a.createElement(m,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,c=new Array(a);c[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,c[1]=i;for(var p=2;p<a;p++)c[p]=n[p];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);